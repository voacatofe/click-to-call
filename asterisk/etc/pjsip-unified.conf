;============================ TRANSPORTE WSS SEGURO ============================
[transport-wss]
type=transport
protocol=wss
bind=127.0.0.1:8089
; Certificados para WSS
cert_file=/etc/asterisk/keys/asterisk.crt
priv_key_file=/etc/asterisk/keys/asterisk.key
; ADICIONADO: Configurações de segurança TLS
method=tlsv1_2
cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256
; CORRIGIDO: External addresses usando variáveis de ambiente (dev-friendly)
external_media_address=${EXTERNAL_IP:-127.0.0.1}
external_signaling_address=${EXTERNAL_IP:-127.0.0.1}

;============================ ENDPOINT WSS-ONLY ============================
; AOR compartilhado para WSS
[agent-1001]
type=aor
max_contacts=10  ; Permitir múltiplas conexões WSS
remove_existing=yes

; Auth compartilhado
[agent-1001]
type=auth
auth_type=userpass
username=agent-1001
password=${AGENT_1001_PASSWORD:-changeme_update_this}

; Endpoint para WSS (produção segura)
[agent-1001-wss]
type=endpoint
aors=agent-1001
auth=agent-1001
transport=transport-wss
context=from-internal
; Configuração completa WebRTC com DTLS SEGURO
webrtc=yes
use_avpf=yes
media_encryption=dtls
dtls_verify=fingerprint
dtls_setup=actpass
; CORRIGIDO: Usar certificados reais ao invés de auto-gerados
dtls_cert_file=/etc/asterisk/keys/asterisk.crt
dtls_private_key=/etc/asterisk/keys/asterisk.key
dtls_ca_file=/etc/asterisk/keys/asterisk.crt
; MANTIDO: Suporte ICE obrigatório para NAT
ice_support=yes
media_use_received_transport=yes
rtcp_mux=yes
disallow=all
allow=opus,ulaw,alaw
rtp_symmetric=yes
force_rport=yes
direct_media=no
timers=yes
timers_min_se=90
timers_sess_expires=1800
; ADICIONADO: Proteção contra DoS DTLS
dtls_rekey=300 